---
const CALENDLY_URL = 'https://calendly.com/aledovidioatan-oywu/30min';
---

<!-- Navbar flotante glass -->
<header
  id="navbar"
  class="fixed top-4 sm:top-6 left-1/2 -translate-x-1/2 w-[94%] max-w-5xl z-50 luxury-glass rounded-full px-4 sm:px-8 py-3 sm:py-4 shadow-xl transition-all duration-500"
>
  <div class="flex justify-between items-center gap-4">

    <!-- Logo -->
    <a href="#inicio" class="flex items-center gap-2.5 flex-shrink-0">
      <span class="material-symbols-outlined text-primary text-2xl sm:text-3xl flex-shrink-0" style="font-variation-settings: 'FILL' 0, 'wght' 300;">spa</span>
      <div class="flex flex-col leading-none">
        <span class="text-sm sm:text-base font-bold tracking-tight uppercase italic text-rose-deep dark:text-text-dark whitespace-nowrap">
          Dra. Alejandra D'Ovidio
        </span>
        <span class="text-[8px] sm:text-[9px] uppercase tracking-[0.18em] text-rose-deep/50 dark:text-text-muted-dark font-semibold hidden sm:block">
          Cirugía Plástica &amp; Estética
        </span>
      </div>
    </a>

    <!-- Nav desktop -->
    <nav class="hidden md:flex items-center gap-8 lg:gap-10">
      <a href="#servicios" class="nav-link text-xs uppercase tracking-widest font-bold text-rose-deep/70 dark:text-text-muted-dark hover:text-primary dark:hover:text-primary transition-colors duration-200">
        Servicios
      </a>
      <a href="#sobre-mi" class="nav-link text-xs uppercase tracking-widest font-bold text-rose-deep/70 dark:text-text-muted-dark hover:text-primary dark:hover:text-primary transition-colors duration-200">
        Sobre mí
      </a>
      <a href="#testimonios" class="nav-link text-xs uppercase tracking-widest font-bold text-rose-deep/70 dark:text-text-muted-dark hover:text-primary dark:hover:text-primary transition-colors duration-200">
        Testimonios
      </a>
      <a href="#contacto" class="nav-link text-xs uppercase tracking-widest font-bold text-rose-deep/70 dark:text-text-muted-dark hover:text-primary dark:hover:text-primary transition-colors duration-200">
        Contacto
      </a>
    </nav>

    <!-- Acciones derecha -->
    <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
      <!-- CTA Calendly desktop -->
      <button
        id="navbar-calendly-btn"
        data-calendly-url={CALENDLY_URL}
        class="hidden md:flex items-center gap-2 bg-primary hover:bg-primary-hover text-white px-5 py-2.5 rounded-full font-bold text-xs uppercase tracking-wider transition-all duration-300 hover:scale-105 shadow-lg shadow-primary/30"
      >
        <span class="material-symbols-outlined text-base" style="font-variation-settings: 'FILL' 0, 'wght' 400;">calendar_month</span>
        Agendar
      </button>

      <!-- Dark mode toggle -->
      <button
        id="theme-toggle"
        aria-label="Cambiar tema"
        class="w-9 h-9 rounded-full flex items-center justify-center text-rose-deep/60 dark:text-text-muted-dark hover:text-primary dark:hover:text-primary hover:bg-primary/10 transition-all duration-200"
      >
        <span id="theme-icon-sun" class="material-symbols-outlined text-xl hidden" style="font-variation-settings: 'FILL' 0, 'wght' 300;">light_mode</span>
        <span id="theme-icon-moon" class="material-symbols-outlined text-xl" style="font-variation-settings: 'FILL' 0, 'wght' 300;">dark_mode</span>
      </button>

      <!-- Hamburger mobile -->
      <button
        id="menu-toggle"
        aria-label="Abrir menú"
        aria-expanded="false"
        class="md:hidden w-9 h-9 rounded-full flex items-center justify-center text-rose-deep/70 dark:text-text-muted-dark hover:text-primary hover:bg-primary/10 transition-all duration-200"
      >
        <span id="menu-icon-open" class="material-symbols-outlined text-2xl" style="font-variation-settings: 'FILL' 0, 'wght' 300;">menu</span>
        <span id="menu-icon-close" class="material-symbols-outlined text-2xl hidden" style="font-variation-settings: 'FILL' 0, 'wght' 300;">close</span>
      </button>
    </div>

  </div>
</header>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-40 flex flex-col justify-center items-center opacity-0 pointer-events-none"
  style="background-color: rgba(249,245,240,0.97); -webkit-backdrop-filter: blur(24px); backdrop-filter: blur(24px); transition: opacity 0.35s ease;"
>
  <!-- Dark overlay version -->
  <div class="dark:block hidden absolute inset-0" style="background-color: rgba(26,18,21,0.97);"></div>

  <nav class="relative z-10 flex flex-col items-center gap-8 pt-safe">
    <a href="#servicios" data-mobile-link class="text-3xl font-black uppercase tracking-widest text-rose-deep dark:text-text-dark hover:text-primary transition-colors duration-200">
      Servicios
    </a>
    <a href="#sobre-mi" data-mobile-link class="text-3xl font-black uppercase tracking-widest text-rose-deep dark:text-text-dark hover:text-primary transition-colors duration-200">
      Sobre mí
    </a>
    <a href="#testimonios" data-mobile-link class="text-3xl font-black uppercase tracking-widest text-rose-deep dark:text-text-dark hover:text-primary transition-colors duration-200">
      Testimonios
    </a>
    <a href="#contacto" data-mobile-link class="text-3xl font-black uppercase tracking-widest text-rose-deep dark:text-text-dark hover:text-primary transition-colors duration-200">
      Contacto
    </a>
    <button
      id="mobile-calendly-btn"
      data-calendly-url={CALENDLY_URL}
      class="mt-6 btn-primary text-base px-10 py-4"
    >
      <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 0, 'wght' 400;">calendar_month</span>
      Agendar Consulta
    </button>
  </nav>
</div>

<script>
  // ---- Dark Mode Toggle ----
  const themeToggle = document.getElementById('theme-toggle');
  const iconSun = document.getElementById('theme-icon-sun');
  const iconMoon = document.getElementById('theme-icon-moon');

  function updateThemeIcons() {
    const isDark = document.documentElement.classList.contains('dark');
    if (isDark) {
      iconSun?.classList.remove('hidden');
      iconMoon?.classList.add('hidden');
    } else {
      iconSun?.classList.add('hidden');
      iconMoon?.classList.remove('hidden');
    }
  }

  updateThemeIcons();

  themeToggle?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    updateThemeIcons();
  });

  // ---- Mobile Menu ----
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');
  const mobileLinks = document.querySelectorAll('[data-mobile-link]');
  let menuOpen = false;

  function openMenu() {
    menuOpen = true;
    mobileMenu!.style.opacity = '1';
    mobileMenu!.style.pointerEvents = 'auto';
    menuIconOpen?.classList.add('hidden');
    menuIconClose?.classList.remove('hidden');
    menuToggle?.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    menuOpen = false;
    mobileMenu!.style.opacity = '0';
    mobileMenu!.style.pointerEvents = 'none';
    menuIconOpen?.classList.remove('hidden');
    menuIconClose?.classList.add('hidden');
    menuToggle?.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
  }

  menuToggle?.addEventListener('click', () => {
    menuOpen ? closeMenu() : openMenu();
  });

  mobileLinks.forEach((link) => link.addEventListener('click', closeMenu));

  // ---- Navbar auto-hide on scroll ----
  const navbar = document.getElementById('navbar');
  let lastScroll = 0;
  let scrollTimer: ReturnType<typeof setTimeout> | null = null;

  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY;

    if (currentScroll <= 60) {
      navbar?.classList.remove('-translate-y-24', 'opacity-0');
      navbar?.classList.add('translate-y-0', 'opacity-100');
    } else if (currentScroll > lastScroll + 8) {
      // Scrolling down
      navbar?.classList.add('-translate-y-24', 'opacity-0');
      navbar?.classList.remove('translate-y-0');
    } else if (currentScroll < lastScroll - 8) {
      // Scrolling up
      navbar?.classList.remove('-translate-y-24', 'opacity-0');
      navbar?.classList.add('translate-y-0', 'opacity-100');
    }

    lastScroll = currentScroll;
  }, { passive: true });

  // ---- Calendly popup ----
  function openCalendly(url: string) {
    window.dispatchEvent(new Event('calendly:open'));
    if (typeof (window as any).Calendly !== 'undefined') {
      (window as any).Calendly.initPopupWidget({ url });
    } else {
      window.open(url, '_blank');
    }
  }

  document.getElementById('navbar-calendly-btn')?.addEventListener('click', (e) => {
    const btn = e.currentTarget as HTMLButtonElement;
    openCalendly(btn.dataset.calendlyUrl || '');
  });

  document.getElementById('mobile-calendly-btn')?.addEventListener('click', (e) => {
    const btn = e.currentTarget as HTMLButtonElement;
    closeMenu();
    openCalendly(btn.dataset.calendlyUrl || '');
  });
</script>
